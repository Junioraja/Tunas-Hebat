<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jurnal Tidur Cepat - TunasHebat</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&family=Digital-7+Mono&display=swap" rel="stylesheet">
    
    <!-- Icons -->
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['"Plus Jakarta Sans"', 'sans-serif'], digital: ['"Courier New"', 'monospace'] },
                    colors: { 
                        night: { 900: '#0f172a', 800: '#1e1b4b', 700: '#312e81' },
                        star: '#fef3c7'
                    },
                    animation: {
                        'shooting-star': 'shooting 3s linear infinite',
                        'twinkle': 'twinkle 2s ease-in-out infinite alternate',
                        'pulse-glow': 'pulseGlow 2s infinite',
                    },
                    keyframes: {
                        shooting: {
                            '0%': { transform: 'translateX(0) translateY(0) rotate(-45deg)', opacity: 1 },
                            '100%': { transform: 'translateX(-500px) translateY(500px) rotate(-45deg)', opacity: 0 }
                        },
                        twinkle: { '0%': { opacity: 0.3, transform: 'scale(0.8)' }, '100%': { opacity: 1, transform: 'scale(1.2)' } },
                        pulseGlow: { '0%': { boxShadow: '0 0 0 0 rgba(99, 102, 241, 0.4)' }, '100%': { boxShadow: '0 0 0 20px rgba(99, 102, 241, 0)' } }
                    }
                }
            }
        }
    </script>

    <style>
        /* Bintang Latar Belakang */
        .stars { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 0; }
        .star { position: absolute; background: white; border-radius: 50%; animation: twinkle var(--duration) ease-in-out infinite; }
        
        /* Shooting Star Tail */
        .shooting-star {
            position: absolute; top: 50px; right: 50px; width: 4px; height: 4px; background: #fff;
            border-radius: 50%; box-shadow: 0 0 0 4px rgba(255, 255, 255, 0.1), 0 0 0 8px rgba(255, 255, 255, 0.1), 0 0 20px rgba(255, 255, 255, 1);
            animation: shooting 5s linear infinite; opacity: 0;
        }
        .shooting-star::before {
            content: ''; position: absolute; top: 50%; transform: translateY(-50%); right: 1px; height: 1px; width: 100px;
            background: linear-gradient(90deg, rgba(255, 255, 255, 1), transparent);
        }
    </style>
</head>
<body class="bg-gradient-to-b from-[#0f0c29] via-[#302b63] to-[#24243e] min-h-screen relative overflow-x-hidden font-sans text-white transition-colors duration-700" id="body-bg">

    <!-- DEKORASI MALAM -->
    <div class="stars" id="stars-container"></div>
    <div class="shooting-star" style="top: 10%; right: 20%; animation-delay: 2s;"></div>
    <div class="shooting-star" style="top: 20%; right: 10%; animation-delay: 5s;"></div>

    <!-- Bulan -->
    <div class="absolute top-10 right-8 w-24 h-24 rounded-full bg-yellow-100 shadow-[0_0_60px_rgba(253,224,71,0.6)] animate-pulse z-0 opacity-80"></div>
    <div class="absolute top-10 right-8 w-24 h-24 rounded-full bg-transparent shadow-[inset_-10px_-10px_0_0_rgba(0,0,0,0.1)] z-0"></div>

    <!-- NAVBAR -->
    <nav class="p-6 flex items-center gap-4 relative z-20">
        <button onclick="window.location.href='dashboard.html'" class="w-10 h-10 bg-white/10 backdrop-blur-md rounded-xl flex items-center justify-center text-white hover:bg-white/20 transition border border-white/20 shadow-lg">
            <i class="ph ph-arrow-left text-xl font-bold"></i>
        </button>
        <div>
            <h1 class="font-bold text-lg drop-shadow-md">Jurnal Tidur</h1>
            <p class="text-indigo-200 text-xs font-medium">Istirahat cukup untuk esok yang cerah</p>
        </div>
    </nav>

    <!-- MAIN CONTENT -->
    <main class="px-4 pb-24 relative z-20 w-full max-w-lg mx-auto mt-4">
        
        <!-- Digital Clock Display -->
        <div class="text-center mb-8 relative">
            <div id="clock-container" class="inline-block bg-white/10 backdrop-blur-md border border-white/20 px-8 py-6 rounded-3xl shadow-2xl relative overflow-hidden transition-all duration-500">
                <!-- Status Badge -->
                <div id="status-badge" class="absolute top-3 right-3 flex items-center gap-1 text-[10px] font-bold bg-black/30 px-2 py-1 rounded-full text-indigo-300">
                    <i class="ph ph-moon-stars-fill"></i> <span id="status-text">Malam</span>
                </div>

                <div class="text-6xl font-bold font-digital tracking-widest text-indigo-100 drop-shadow-[0_0_10px_rgba(165,180,252,0.8)] transition-colors duration-300" id="clock-time">
                    00:00
                </div>
                <div class="text-indigo-300 text-sm font-medium mt-1 tracking-wide uppercase" id="clock-date">
                    -- --- ----
                </div>
            </div>
        </div>

        <!-- CARD UTAMA -->
        <div class="bg-white/10 backdrop-blur-xl border border-white/20 rounded-[2.5rem] p-8 shadow-2xl relative overflow-hidden transition-all duration-500" id="main-card">
            
            <!-- Dynamic Heading -->
            <div class="text-center mb-6">
                <h2 id="page-title" class="text-2xl font-bold text-white mb-2 transition-all">Selamat Malam</h2>
                <p id="page-desc" class="text-indigo-200 text-sm">Target tidur: <strong>19:00 - 22:00</strong> WIB</p>
            </div>

            <!-- FORM CONTAINER -->
            <div class="space-y-5" id="form-container">
                
                <!-- NORMAL NOTE (Default) -->
                <div id="normal-input-group" class="transition-all duration-300">
                    <label class="block text-sm font-bold text-indigo-100 mb-2">Catatan Mimpi (Opsional)</label>
                    <textarea id="note-input" rows="2" placeholder="Apa yang kamu syukuri hari ini?" class="w-full px-4 py-3 rounded-xl bg-black/20 border border-indigo-500/30 text-white placeholder-indigo-400/50 focus:border-indigo-400 focus:outline-none transition resize-none"></textarea>
                </div>

                <!-- LATE INPUT GROUP (Hidden by default) -->
                <div id="late-input-group" class="hidden space-y-4 animate-fade-in">
                    <div class="bg-red-500/20 border border-red-500/50 p-4 rounded-xl flex items-start gap-3">
                        <i class="ph ph-warning-circle-fill text-red-400 text-xl mt-0.5"></i>
                        <div>
                            <h4 class="font-bold text-red-100 text-sm">Kamu Begadang!</h4>
                            <p class="text-xs text-red-200/80">Tidur larut menurunkan daya ingat & fokus.</p>
                        </div>
                    </div>

                    <div>
                        <label class="block text-sm font-bold text-red-200 mb-2">Alasan Begadang <span class="text-red-500">*</span></label>
                        <select id="late-reason" class="w-full px-4 py-3 rounded-xl bg-black/30 border border-red-500/30 text-white focus:border-red-500 focus:outline-none appearance-none">
                            <option value="">Pilih Alasan...</option>
                            <option value="tugas">Mengerjakan Tugas Sekolah</option>
                            <option value="belajar">Belajar untuk Ujian</option>
                            <option value="ibadah">Ibadah Malam</option>
                            <option value="keluarga">Acara Keluarga</option>
                            <option value="sakit">Sakit / Tidak Enak Badan</option>
                            <option value="main">Main Game / Sosmed (Jujur ya!)</option>
                        </select>
                    </div>

                    <div>
                        <label class="block text-sm font-bold text-red-200 mb-2">Foto Bukti Kegiatan <span class="text-red-500">*</span></label>
                        <label class="flex flex-col items-center justify-center w-full h-24 border-2 border-red-500/30 border-dashed rounded-xl cursor-pointer hover:bg-red-500/10 transition group">
                            <div class="flex flex-col items-center justify-center pt-2 pb-3">
                                <i class="ph ph-camera text-2xl text-red-400 group-hover:text-red-200 mb-1 transition"></i>
                                <p id="file-name" class="text-[10px] text-red-300">Klik untuk upload bukti</p>
                            </div>
                            <input type="file" class="hidden" onchange="updateFileName(this)" accept="image/*">
                        </label>
                    </div>
                </div>

                <!-- BUTTON -->
                <button onclick="checkInSleep()" id="btn-checkin" class="w-full py-4 bg-gradient-to-r from-indigo-500 to-purple-600 hover:from-indigo-400 hover:to-purple-500 text-white font-bold rounded-2xl shadow-[0_0_20px_rgba(99,102,241,0.4)] transition transform active:scale-95 flex items-center justify-center gap-2 text-lg animate-pulse-glow">
                    <i class="ph ph-moon-stars text-2xl"></i>
                    <span id="btn-text">Selamat Tidur</span>
                </button>
            </div>

        </div>

        <!-- DEV MODE (Hidden) -->
        <div class="mt-8 opacity-20 hover:opacity-100 transition text-center">
            <input type="time" id="sim-time" class="bg-black/50 text-white border border-white/20 rounded px-2 py-1 text-xs">
            <button onclick="toggleSim()" class="text-xs text-white underline ml-2">Set Jam (Dev)</button>
        </div>

    </main>

    <!-- POPUP BLOCKED (TOO EARLY) -->
    <div id="modal-early" class="fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-md hidden opacity-0 transition-opacity duration-300">
        <div class="bg-[#1e1b4b] border border-indigo-500/30 rounded-[2rem] p-8 max-w-sm w-full mx-4 text-center transform scale-90 transition-transform duration-300 relative overflow-hidden">
            <!-- Sun Rays Animation -->
            <div class="absolute top-0 left-1/2 -translate-x-1/2 w-64 h-64 bg-yellow-500/10 rounded-full blur-3xl -mt-20"></div>
            
            <div class="w-20 h-20 bg-indigo-900 rounded-full flex items-center justify-center mx-auto mb-4 border border-indigo-700 relative z-10">
                <i class="ph ph-sun-horizon text-4xl text-yellow-400"></i>
            </div>
            <h3 class="text-2xl font-bold text-white mb-2 relative z-10">Belum Waktunya!</h3>
            <p class="text-indigo-200 mb-6 text-sm relative z-10">Jurnal tidur malam hanya bisa diisi mulai pukul <strong>19:00 WIB</strong>.</p>
            
            <button onclick="window.location.href='dashboard.html'" class="w-full py-3 bg-indigo-600 text-white font-bold rounded-xl hover:bg-indigo-500 transition relative z-10">
                Kembali ke Dashboard
            </button>
        </div>
    </div>

    <script>
        // --- STARS GENERATOR ---
        function createStars() {
            const container = document.getElementById('stars-container');
            const count = 50;
            for (let i = 0; i < count; i++) {
                const star = document.createElement('div');
                star.className = 'star';
                const xy = Math.random() * 100;
                const duration = Math.random() * 3 + 2; // 2-5s
                const size = Math.random() * 2 + 1;
                
                star.style.left = Math.random() * 100 + '%';
                star.style.top = Math.random() * 100 + '%';
                star.style.width = size + 'px';
                star.style.height = size + 'px';
                star.style.setProperty('--duration', duration + 's');
                star.style.animationDelay = Math.random() * 5 + 's';
                
                container.appendChild(star);
            }
        }
        createStars();

        // --- LOGIC ---
        let simulationMode = false;
        let isLate = false;

        function updateClock() {
            const now = new Date();
            let hours = now.getHours();
            let minutes = now.getMinutes();

            // DEV SIMULATION
            if (simulationMode) {
                const simVal = document.getElementById('sim-time').value;
                if(simVal) {
                    const [h, m] = simVal.split(':');
                    hours = parseInt(h);
                    minutes = parseInt(m);
                }
            }

            // Display
            document.getElementById('clock-time').textContent = `${String(hours).padStart(2,'0')}:${String(minutes).padStart(2,'0')}`;
            const options = { weekday: 'long', day: 'numeric', month: 'short' };
            document.getElementById('clock-date').textContent = now.toLocaleDateString('id-ID', options);

            // LOGIC CHECK
            checkTimeStatus(hours, minutes);
        }

        function checkTimeStatus(h, m) {
            const modalEarly = document.getElementById('modal-early');
            const mainCard = document.getElementById('main-card');
            const pageTitle = document.getElementById('page-title');
            const pageDesc = document.getElementById('page-desc');
            const btnText = document.getElementById('btn-text');
            const lateGroup = document.getElementById('late-input-group');
            const noteGroup = document.getElementById('normal-input-group');
            const statusBadge = document.getElementById('status-badge');
            const statusText = document.getElementById('status-text');

            // 1. TOO EARLY (< 19:00)
            if (h < 19) {
                modalEarly.classList.remove('hidden', 'opacity-0'); // Show Block Modal
                // Disable main interaction behind modal (Visual only as modal covers it)
            } else {
                modalEarly.classList.add('opacity-0'); // Hide Block Modal
                setTimeout(() => modalEarly.classList.add('hidden'), 300);
            }

            // 2. LATE (> 22:00)
            if (h >= 22 || (h >= 0 && h < 5)) { // Late until 5 AM
                isLate = true;
                
                // UI Changes for Late
                mainCard.className = "bg-red-950/40 backdrop-blur-xl border border-red-500/30 rounded-[2.5rem] p-8 shadow-2xl relative overflow-hidden transition-all duration-500";
                pageTitle.innerText = "JANGAN BEGADANG!";
                pageTitle.className = "text-3xl font-extrabold text-red-500 mb-2 transition-all animate-pulse";
                pageDesc.innerText = "Sudah lewat jam 22:00. Segera tidur!";
                
                lateGroup.classList.remove('hidden');
                noteGroup.classList.add('hidden'); // Hide normal note
                
                btnText.innerText = "Lapor & Tidur";
                document.getElementById('btn-checkin').className = "w-full py-4 bg-red-600 hover:bg-red-700 text-white font-bold rounded-2xl shadow-lg transition transform active:scale-95 flex items-center justify-center gap-2 text-lg";

                statusBadge.className = "absolute top-3 right-3 flex items-center gap-1 text-[10px] font-bold bg-red-900/50 border border-red-500 px-2 py-1 rounded-full text-red-200";
                statusText.innerText = "Terlambat";

            } else if (h >= 19 && h < 22) {
                // 3. ON TIME (19:00 - 22:00)
                isLate = false;
                
                // Reset UI
                mainCard.className = "bg-white/10 backdrop-blur-xl border border-white/20 rounded-[2.5rem] p-8 shadow-2xl relative overflow-hidden transition-all duration-500";
                pageTitle.innerText = "Selamat Malam";
                pageTitle.className = "text-2xl font-bold text-white mb-2 transition-all";
                pageDesc.innerHTML = "Target tidur: <strong>19:00 - 22:00</strong> WIB";

                lateGroup.classList.add('hidden');
                noteGroup.classList.remove('hidden');

                btnText.innerText = "Selamat Tidur";
                document.getElementById('btn-checkin').className = "w-full py-4 bg-gradient-to-r from-indigo-500 to-purple-600 hover:from-indigo-400 hover:to-purple-500 text-white font-bold rounded-2xl shadow-[0_0_20px_rgba(99,102,241,0.4)] transition transform active:scale-95 flex items-center justify-center gap-2 text-lg animate-pulse-glow";

                statusBadge.className = "absolute top-3 right-3 flex items-center gap-1 text-[10px] font-bold bg-black/30 px-2 py-1 rounded-full text-indigo-300";
                statusText.innerText = "Waktunya Tidur";
            }
        }

        // --- FILE PREVIEW ---
        function updateFileName(input) {
            const fileName = input.files[0]?.name;
            const label = document.getElementById('file-name');
            if(fileName) {
                label.innerText = fileName;
                label.classList.add('text-white', 'font-bold');
            }
        }

        // --- SUBMIT LOGIC ---
        function checkInSleep() {
            if (isLate) {
                const reason = document.getElementById('late-reason').value;
                const file = document.querySelector('input[type="file"]').files.length;

                if (!reason || file === 0) {
                    alert("Karena begadang, mohon isi alasan dan bukti foto (kegiatan positif) ya!");
                    return;
                }
                alert("Laporan begadang dicatat. Poin dikurangi sedikit. Jangan diulangi ya!");
            } else {
                confetti({
                    particleCount: 150,
                    spread: 100,
                    origin: { y: 0.6 },
                    colors: ['#6366f1', '#a855f7', '#ffffff']
                });
                alert("Selamat tidur! Poin ketepatan waktu +50.");
            }
            window.location.href = 'dashboard.html';
        }

        function toggleSim() { simulationMode = !simulationMode; updateClock(); }
        setInterval(updateClock, 1000);
        updateClock();
    </script>
</body>
</html>